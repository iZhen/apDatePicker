/*!
 * apDatePicker v1.0
 * Copyright (c) 2013 Zhen.  All rights reserved.
 */
(function(){$.fn.apDatePicker=function(c){var d="apDatePicker";var b=this.data(d);
if(!b){return this.each(function(){return $(this).data(d,new a(this,c));});}else{if(c===true){return b;}else{return this.each(function(){var f=$(this).data(d),e=f.options;
$.extend(true,f.options,c);f.render();return $(this);});}}};$.fn.apDatePicker.options={type:"day",format:null,zIndex:1000,calendarOffset:{x:0,y:1},hideOnClick:true,showAlways:false,startDayOfWeek:0,todayDate:new Date(),selectedDate:null,allowMonthSelect:true,allowYearSelect:true,selectableDateRange:null,selectableDates:null,selectableDOW:null,selectableMonths:null,selectableQuarters:null,selectableYears:null,firstDate:null,text:{prevArrow:"\u25c4",nextArrow:"\u25ba",year:"年",week:"周",quarter:"季度",month:"月份",qoy:["第1季度","第2季度","第3季度","第4季度"],moy:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dow:["日","一","二","三","四","五","六"]},events:{onClick:function(c,b,d){if(!c||!b){return;
}if(d==null){c.val(b.toLocaleDateString());}else{c.val(b._format(d));}},onShow:function(b){b.show();},onHide:function(b){b.hide();}}};var a=(function(){function b(e,g){var c=this;
c.ele=$(e);var f=c.ele;g=g||{};c.options=$.extend(true,{},$.fn.apDatePicker.options,g);var d=c.options;d.events.onClick(f,d.selectedDate,d.format);c.calendar=$($.find("[apdp-ele="+f.attr("apdp-id")+" ]"));
d.selectedDate=d.selectedDate||d.todayDate;d.firstDate=(new Date((d.firstDate||d.selectedDate)))._firstDayOfMonth();if(!(f.attr("apdp-id")||"").length){f.attr("apdp-id","apdp-"+Math.round(Math.random()*10000000000));
}f.addClass("apdp-ele").bind("click",function(h){c.show(h);}).bind("focus",function(h){c.show(h);});if(c.calendar.length&&!d.showAlways){c.calendar.hide();
}$(document).bind("mouseup",function(j){var i=j.target;var h=c.calendar;if(!f.is(i)&&!h.is(i)&&h.has(i).length===0&&h.is(":visible")){c.hide();}});c.render();
}b.prototype={show:function(){$.each($(".apdp-ele").not(this.ele),function(c,d){if(d.length){d.options.events.onHide(d.calendar);}});this.options.events.onShow(this.calendar);
},hide:function(){if(this.options&&!this.options.showAlways){this.options.events.onHide(this.calendar);}},remove:function(){},render:function(k){var o=this,p=o.ele,q=o.options,f=o.calendar;
k=k||q.type;if(!f.length){o.calendar=f=$("<div/>").attr("apdp-ele",p.attr("apdp-id")).css({display:(q.showAlways?undefined:"none"),zIndex:q.zIndex}).appendTo("body");
}else{f.empty();}if(!p.is(":visible")){f.hide();}f.removeClass().addClass("apdp").empty();var c=function(){var r=p.offset();f.css({top:(r.top+p.outerHeight()+q.calendarOffset.y)+"px",left:(r.left+q.calendarOffset.x)+"px"});
};$(window).resize(c);c();var l=$("<div/>").addClass("head"),j=$("<div/>").addClass("prev"),n=$("<div/>").addClass("next"),m=$("<div/>").addClass("title");
f.append(l);l.append(j).append(m).append(n);j.append($("<a/>").html(q.text.prevArrow)).mousedown(function(){return false;});n.append($("<a/>").html(q.text.nextArrow)).mousedown(function(){return false;
});var i=$("<table/>");f.append(i);function h(E){E=E||"day";i.addClass(E);var F=$("<thead/>").appendTo(i),B=$("<tbody/>").appendTo(i);var u=$("<div/>").html(q.firstDate.getFullYear()+q.text.year).click(function(){o.render("year");
}).appendTo(m);var G=$("<div/>").html(q.text.moy[q.firstDate.getMonth()]).click(function(){o.render("month");}).appendTo(m);j.click(function(r){r.stopPropagation();
q.firstDate._addMonth(-1);o.render(k);});n.click(function(r){r.stopPropagation();q.firstDate._addMonth(1);o.render(k);});var H=$("<tr/>").appendTo(F);H.append($("<th/>").addClass("week").html(q.text.week));
for(var A=q.startDayOfWeek;A<q.startDayOfWeek+7;A++){var D=A%7;var I=$("<th/>").html(q.text.dow[D]).addClass(D==0||D==6?"weekend":"weekday");H.append(I);
}var x=q.firstDate._firstDayOfMonth(),t=x.getMonth();x._addDay(q.startDayOfWeek-x.getDay());dowClass=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(var s=0;
s<6;s++){var w=$("<tr/>").appendTo(B);var z=$("<td/>").appendTo(w),v=$("<div/>").html(x._weekOfYear(q.startDayOfWeek)).appendTo(z);if(E=="week"){v.data("date",new Date(x)).click(e);
}else{v.addClass("disabled");}v.addClass("week");for(var A=0;A<7;A++){var C=$("<td/>").appendTo(w),y=$("<div/>").html(x.getDate()).appendTo(C);y.attr("title",x._format(q.format)).data("date",new Date(x));
if(x.getMonth()!=t){y.addClass("outday").click(e);}if(x.getDay()==(0||6)){y.addClass("weekend");}else{y.addClass("weekday");}y.addClass(dowClass[x.getDay()]);
if(x.getMonth()==t){y.click(e);}if(x.toLocaleDateString()==q.selectedDate.toLocaleDateString()){y.addClass("selected");w.addClass("selected");}x._addDay(1);
}}}function d(z){z=z||"month";i.addClass(z);var B=$("<thead/>").appendTo(i),y=$("<tbody/>").appendTo(i);var u=$("<div/>").html(q.firstDate.getFullYear()+q.text.year).appendTo(m).click(function(){o.render("year");
});j.click(function(r){r.stopPropagation();q.firstDate._addYear(-1);o.render(k);});n.click(function(r){r.stopPropagation();q.firstDate._addYear(1);o.render(k);
});var D=$("<tr/>").appendTo(B);D.append($("<th/>").addClass("quarter").html(q.text.quarter));D.append($("<th/>").attr("colspan","3").addClass("month").html(q.text.month));
var w=q.firstDate._firstDayOfYear();for(var t=0;t<4;t++){var v=$("<tr/>").appendTo(y);var E=$("<td/>").appendTo(v),A=$("<div/>").html(q.text.qoy[t]).appendTo(E);
if(z=="quarter"){A.data("date",new Date(w)).click(e);}else{A.addClass("disabled");}A.addClass("quarter");for(var x=0;x<3;x++){var s=$("<td/>").appendTo(v),C=$("<div/>").html(q.text.moy[w.getMonth()]).appendTo(s);
C.attr("title",w._format(q.format));C.data("date",new Date(w)).click(e);if(w.getMonth()==q.selectedDate.getMonth()&&w.getFullYear()==q.selectedDate.getFullYear()){C.addClass("selected");
v.addClass("selected");}w._addMonth(1);}}}function g(){i.addClass("year");var v=$("<tbody/>").appendTo(i);year=q.firstDate.getFullYear();var t=$("<div/>").html((year-12)+q.text.year+" - "+(year+12)+q.text.year).appendTo(m);
j.click(function(r){r.stopPropagation();q.firstDate._addYear(-25);o.render(k);});n.click(function(r){r.stopPropagation();q.firstDate._addYear(25);o.render(k);
});var u=q.firstDate._firstDayOfYear();u._addYear(-12);for(var y=0;y<5;y++){var z=$("<tr/>").appendTo(v);for(var x=0;x<5;x++){var w=$("<td/>").appendTo(z),s=$("<div/>").html(u.getFullYear()).appendTo(w);
s.attr("title",u._format(q.format)).data("date",new Date(u)).click(e);if(u.getFullYear()==q.selectedDate.getFullYear()){s.addClass("selected");}u._addYear(1);
}}}function e(s){s.stopPropagation();var r=$(this).data("date");if(k!=q.type||$(this).hasClass("outday")){q.firstDate=r;o.render();}else{q.selectedDate=new Date(r);
q.firstDate=new Date(r);q.events.onClick(p,r,q.format);o.render();}if(q.hideOnClick&&!q.showAlways&&k==q.type){o.hide();}}switch(k){case"day":h("day");
break;case"week":h("week");break;case"month":d("month");break;case"quarter":d("quarter");break;case"year":g("year");break;default:h("day");break;}}};return b;
})();(function(){Date.prototype._val=function(){return{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),day:this.getDay()};
};Date.prototype._addDay=function(b){if(b&&typeof(b)=="number"){this.setDate(this.getDate()+b);}};Date.prototype._addMonth=function(b){if(b&&typeof(b)=="number"){this.setMonth(this.getMonth()+b);
}};Date.prototype._addYear=function(b){if(b&&typeof(b)=="number"){this.setFullYear(this.getFullYear()+b);}};Date.prototype._firstDayOfMonth=function(){var b=new Date(this);
b.setDate(1);return b;};Date.prototype._lastDayOfMonth=function(){var b=new Date(this);b.setMonth(this.getMonth()+1);b.setDate(0);return b;};Date.prototype._firstDayOfYear=function(){var b=new Date(this);
b.setDate(1);b.setMonth(0);return b;};Date.prototype._weekOfYear=function(c){var b=(typeof(c)=="number")?c:1,f=new Date(this.getFullYear(),0,0);var e=(new Date(this.getFullYear(),0,1)).getDay()-b;
if(e<0){e=e+7;}var d=Math.ceil((this.getTime()-f.getTime())/(7*24*60*60*1000)+(e/7));return d;};Date.prototype._quarterOfYear=function(){return((this.getMonth()/3)|0);
};Date.prototype._format=function(c){var b=(c&&typeof(c)=="string")?c:"yyyy-mm-dd";b=b.replace(/qq/g,this._quarterOfYear()+1);b=b.replace(/woy/g,this._weekOfYear());
b=b.replace(/yyyy/g,this.getFullYear());b=b.replace(/mm/g,this.getMonth()+1);b=b.replace(/dd/g,this.getDate());return b;};})();})();